### ex6_week16

- **某工厂有5个车间生产某种产品，每个车间的生产能力、单位产品成本、库存原材料总量、单位产品消耗的原材料量如下表所示。**现在，该工厂要生产产品4500吨，问该如何安排各车间的生产任务才能使总成本达到最低。

| 车间 | 生产能力（吨） | 单位产品成本（万元） | 库存原材料总量（吨） | 单位产品消耗的原材料量 |
| ---- | -------------- | -------------------- | -------------------- | ---------------------- |
| 1    | 1600           | 0.5                  | 1000                 | 0.76                   |
| 2    | 1400           | 0.6                  | 1200                 | 0.78                   |
| 3    | 800            | 0.7                  | 900                  | 0.80                   |
| 4    | 650            | 0.75                 | 800                  | 0.82                   |
| 5    | 1000           | 0.8                  | 1200                 | 0.85                   |

分析

$$
\begin{equation}
\min \mathrm{COST} = 0.5 x_1 + 0.6x_2 + 0.7x_3 + 0.75x_4 + 0.8x_5 \\
\begin{aligned}
\mathrm{s.t.} \quad & x_1 + x_2 + x_3 + x_4 + x_5 = 4500 \\
& 0 \leq x_1 \leq 1600 \\
& 0.76 * x_1 \leq 1000 \\
& 0 \leq x_2 \leq 1400 \\
& 0.78 * x_2 \leq 1200 \\
& 0 \leq x_3 \leq 800 \\
& 0.8 * x_3 \leq 900 \\
& 0 \leq x_4 \leq 650 \\
& 0.82 * x_4 \leq 800 \\
& 0 \leq x_4 \leq 1000 \\
& 0.85 * x_4 \leq 1200 \\
\end{aligned}
\end{equation}
$$

代码

```matlab
% ex6_1
% f^T x 即为优化的函数，系数向量，直接写成列向量
f=[0.5; 0.6; 0.7; 0.75; 0.8];
% 分别是等式左右侧 A_{eq} x = b_{eq}
Aeq=[1 1 1 1 1];
beq=4500; 
% 对应元素的上下界 [lb, ub]
lb=[0 0 0 0 0];
ub=[1600 1400 800 650 1000];
% 对应不等式矩阵 Ax <= b
A=[0.76 0 0 0 0;
   0 0.78 0 0 0;
   0 0 0.8 0 0;
   0 0 0 0.82 0;
   0 0 0 0 0.85];
b=[1000;1200;900;800;1200];
% 求解 x对应结果，fval对应最小化值
[x,fval] =linprog(f,A,b,Aeq,beq,lb,ub);
fprintf('each element = [%f,%f,%f,%f,%f]\n',x);
fprintf('min res = %f\n', fval);
```

结果

```matlab
Optimal solution found.

each element = [1315.789474,1400.000000,800.000000,650.000000,334.210526]
min res = 2812.763158
```

- **在区间[-10 10]上，求下列函数最小值**

$$
f(x) = (x-2)^{4} \sin x - (x-1)^{2} \cos x
$$

代码

```matlab
% ex6_2
% 画图得到最小值约在-8左右，为了避开局部最小
x = -10:0.01:10;
y = (x-2).^4.* sin(x)-(x-1).^2.* cos(x);
plot(x,y);
% 找到带有约束的多变量函数最小值
% [x,fval] = fmincon(fun,x0,A,b,Aeq,beq,lb,ub)
% fun即函数
% x0为初始值
% Ax <= b 即为不等式矩阵，此题没有
% A_{eq}x = b_{eq}
% lb,ub为上下限
fun = @(x) (x-2)^4*sin(x)-(x-1)^2*cos(x);
x0 = -9;
lb = -10;
ub = 10;
% 得到最小值！
x = fmincon(fun,x0,[],[],[],[],lb,ub);
sprintf('Min = %f', x)
```

结果

```
ans =
    'Min = -8.219713'
```

- **求下面函数的极小值**

$$
\mathrm{f}(\mathrm{x})=\mathrm{x}_{1}+\frac{1}{\mathrm{x}_{1}}+\mathrm{x}_{2}+\frac{1}{\mathrm{x}_{2}}, \mathrm{x}_{1}, \mathrm{x}_{2} > 0
$$

代码

```matlab
% ex6_3
%% 画图
x1 = 0.01:0.01:20;
x2 = 0.01:0.01:20;
[X, Y] = meshgrid(x1, x2);
Z = X+1./X+Y+1./Y;
surf(X,Y,Z)
%% 求解
fun = @(x) x(1)+1/x(1)+x(2)+1/x(2);
% 使用无导数法计算无约束的多变量函数的局部最小值 x = fminsearch(fun,x0)
[x,fval]=fminsearch(fun,[2,2]);
% fval 中返回目标函数 fun 在解 x 处的值。
% x0为初始值
sprintf('The Min %f can be found in [%f, %f].', fval, x)
```

结果

```matlab
ans =
    'The Min 4.000000 can be found in [1.000000, 1.000000].'
```

- **某车间有甲、乙两台机床，可用于加工三种工件。假定这两台车床的可用台时数分别为800和900，三种工件的数量分别为400、600和500，且已知用两种不同车床加工单位数量不同工件所需的台时数和加工费用如下表。问怎样分配车床的加工任务，才能既满足加工工件的要求，又使加工费用最低？** 

|          | 单位工件 | 所需台时数 |       | 单位  | 加工  | 费用  |            |
| -------- | -------- | ---------- | ----- | ----- | ----- | ----- | ---------- |
| 车床类型 | 工件1    | 工件2      | 工件3 | 工件1 | 工件2 | 工件3 | 可用台时数 |
| 甲       | 0.4      | 1.1        | 1.0   | 13    | 9     | 10    | 800        |
| 乙       | 0.5      | 1.2        | 1.3   | 11    | 12    | 8     | 900        |

设在甲车床上加工工件1、2、3的数量分别为x11、x12、x13，在乙车床上加工工件1、2、3的数量分别为x21、x22、x22。可建立以下线性规划模型：

分析
$$
\begin{equation}
\min 13x_{11} + 9x_{12} + 10x_{13} + 11x_{21} + 12x_{22} + 8x_{23} \\
\begin{aligned}
& 0.4x_{11} + 1.1x_{12} + 1.0x_{13} \leq 800 \\
& 0.5x_{21} + 1.2x_{22} + 1.3x_{23} \leq 900 \\
& x_{11} + x_{21} = 400 \\
& x_{12} + x_{22} = 600 \\
& x_{13} + x_{23} = 500 \\
& x_i > 0
\end{aligned}
\end{equation}
$$
代码

```
% ex6_4
% f^T x 即为优化的函数，系数向量，直接写成列向量
f=[13; 9; 10; 11; 12; 8];
% 分别是等式左右侧 A_{eq} x = b_{eq}
Aeq = [1 0 0 1 0 0; 0 1 0 0 1 0; 0 0 1 0 0 1]; % 3x6
beq = [400; 600; 500]; 
% 对应元素的上下界 [lb, ub]
lb=[0 0 0 0 0 0];
% 对应不等式矩阵 Ax <= b
A=[0.4 1.1 1.0 0 0 0;
   0 0 0 0.5 1.2 1.3];
b=[800;900];
% 求解 x对应结果，fval对应最小化值
[x,fval] =linprog(f,A,b,Aeq,beq,lb);
fprintf('each element = [%f,%f,%f,%f,%f,%f]\n',x);
fprintf('min res = %f\n', fval);
```

结果

```
Optimal solution found.

each element = [0.000000,600.000000,0.000000,400.000000,0.000000,500.000000]
min res = 13800.000000	
```